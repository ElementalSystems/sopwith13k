var _kb={};var _kbel;function attachKb(el){el.onkeydown=function(e){e=e||window.event;_kb[e.keyCode]=true};el.onkeyup=function(e){e=e||window.event;_kb[e.keyCode]=false};_kbel=el;focusKb()}function focusKb(){_kbel.focus()}function kbd(c){return!!_kb[c]}var _landAlt=[0,0,0,0,0,2,5,6,11,14,15,16,17,16,16,14,12,12,16,16,16,15,12,12,12,14,14,15,14,12,12,12,12,15,15,16,16,16,15,14,14,14,14,14,14,14,14,14,15,14,12,12,12,12,12,12,12,12,12,12,12,15,15,15,16,16,16,15,14,14,12,12,14,16,16,16,15,14,14,16,16,16,16,16,16,16,15,10,10,5,2,0,0,0,0,0,0,0,0,0];function getLa(x){if(x<100)return _landAlt[0]*100;if(x>19600)return _landAlt[99]*100;let i=Math.floor(x/200);let r=(x-i*200)/200;return((1-r)*_landAlt[i]+r*_landAlt[i+1])*100}addSoDef({name:"landb",w:2e4,h:2e3,onCreate:function(){var p="M 0 3000";for(var i=0;i<2e4;i+=200)p+=" L "+i+" "+getLa(i);p+=" V 3000 Z";this.e.querySelector("path").setAttribute("d",p)},tCol:function(x,y,x2,y2){if(getLa(x)<y)return{x:x,y:getLa(x)};if(getLa(x2)<y2)return{x:x,y:getLa(x)};return null}});function start(){attachKb(document.getElementById("top"));stW()}addSoDef({name:"plane",w:200,h:100,sp:1,spmax:1.8,spmin:.7,spdir:0,acc:.002,md:0,rotsp:.2,rotdir:0,tick:function(ft,t){this.pilot();this.sp=lim(this.sp+this.acc*this.spdir*ft,this.spmin,this.spmax);this.place(this.x+this.rdx*this.sp*ft,this.y+this.rdy*this.sp*ft,this.rot+this.rotsp*this.rotdir*ft);var col=tColW(this,this.pX(-this.w/2,0),this.pY(-this.w/2,0),this.pX(+this.w/2,0),this.pY(+this.w/2,0));if(col){}},pilot:function(ft,t){}});addSoDef({name:"player",ftick:function(ft){lookAtW(this.x)},pilot:function(ft,t){this.rotdir=kbd(188)||kbd(37)?-1:kbd(190)||kbd(39)?1:0;this.spdir=kbd(88)||kbd(65)?1:kbd(90)?-1:0}});function addSoDef(def){if(!window._sodef)window._sodef={};window._sodef[def.name]=def}addSoDef({name:"so",x:-1e3,y:-1e3,w:100,h:100,rot:0,rdx:1,rdy:0,pX:function(x,y){return this.x+this.rdx*x-this.rdy*y},pY:function(x,y){return this.y+this.rdx*y+this.rdy*x},tDirty:true,place:function(nx,ny,nr){if(nx!==undefined)this.x=nx;if(ny!==undefined)this.y=ny;if(nr!==undefined){this.rot=nr;this.rdx=Math.cos(nr*Math.PI/180);this.rdy=Math.sin(nr*Math.PI/180)}this.tDirty=true},setT:function(){if(!this.tDirty)return;this.e.setAttribute("transform","translate("+(this.x-this.w/2)+","+(this.y-this.h/2)+") rotate("+this.rot+","+this.w/2+","+this.h/2+")");this.tDirty=false},onCreate:function(){},tick:function(ft,t){},ftick:function(ft,t){},tCol:function(x,y,x2,y2){return li(x,y,x2,y2,this.pX(-this.w/2,-this.h/2),this.pY(-this.w/2,-this.h/2),this.pX(this.w/2,this.h/2),this.pY(this.w/2,this.h/2))||li(x,y,x2,y2,this.pX(-this.w/2,this.h/2),this.pY(-this.w/2,this.h/2),this.pX(this.w/2,-this.h/2),this.pY(this.w/2,-this.h/2))}});function mkSo(id,cls,x,y,r){var df=document.importNode(document.querySelector("#"+id).content,true);var e=df.querySelector("g");e.classList.add(cls);ret={e:e};Object.assign(ret,window._sodef["so"]);if(window._sodef[id])Object.assign(ret,window._sodef[id]);if(window._sodef[cls])ret=Object.assign(ret,window._sodef[cls]);ret.onCreate();ret.place(x,y,r);return ret}function lim(v,b,t){return v<b?b:v>t?t:v}function li(p0_x,p0_y,p1_x,p1_y,p2_x,p2_y,p3_x,p3_y){var s1_x=p1_x-p0_x,s1_y=p1_y-p0_y,s2_x=p3_x-p2_x,s2_y=p3_y-p2_y;var dm=-s2_x*s1_y+s1_x*s2_y;if(dm===0)dm=1e-7;var s=(-s1_y*(p0_x-p2_x)+s1_x*(p0_y-p2_y))/dm;var t=(s2_x*(p0_y-p2_y)-s2_y*(p0_x-p2_x))/dm;if(s>=0&&s<=1&&t>=0&&t<=1){return{x:p0_x+t*s1_x,y:p0_y+t*s1_y}}return null}var _so=[];var _wel=document.getElementById("world");function addSo(ty,cls,x,y,r){let so=mkSo(ty,cls,x,y,r);_wel.appendChild(so.e);_so.push(so)}function stW(){addSo("plane","player",2e3,350,0);addSo("plane","enemy",1600,600,0);addSo("plane","enemy",1400,200,0);addSo("landb","std",1e4,1e3);setInterval(function(){document.getElementById("world").classList.toggle("y84",kbd(32))},500);requestAnimationFrame(gl)}function lookAtW(x){_wel.setAttribute("viewBox",x-1e3+",0,20000,2000")}function tColW(ig,x,y,x2,y2){console.log(x,y,x2,y2);for(let i=0;i<_so.length;i+=1){if(ig===_so[i])continue;let res=_so[i].tCol(x,y,x2,y2);if(res){res.o=_so[i];return res}}return null}var _st=0;function gl(t){let ft=10;if(_st)ft=t-_st;if(ft>100)ft=100;_st=t;_so.forEach(o=>{o.tick(ft,t)});_so.forEach(o=>{o.ftick(ft,t);o.setT()});requestAnimationFrame(gl)}